<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Tracking Concepts - EngineBlock</title>
    <meta name="generator" content="Hugo 0.31" />

    
    <meta name="description" content="EngineBlock Docs">
    
    <link rel="canonical" href="http://docs.engineblock.io/sketches/tracking_concepts/">
    

    <meta property="og:url" content="http://docs.engineblock.io/sketches/tracking_concepts/">
    <meta property="og:title" content="EngineBlock">
    <meta property="og:image" content="http://docs.engineblock.io/images/engineblock_128.png">
    <meta name="apple-mobile-web-app-title" content="EngineBlock">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="http://docs.engineblock.io/images/engineblock_32.png">
    <link rel="icon" type="image/x-icon" href="http://docs.engineblock.io/images/engineblock_32.png">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('http://docs.engineblock.io/fonts/icon.eot');
        src: url('http://docs.engineblock.io/fonts/icon.eot')
               format('embedded-opentype'),
             url('http://docs.engineblock.io/fonts/icon.woff')
               format('woff'),
             url('http://docs.engineblock.io/fonts/icon.ttf')
               format('truetype'),
             url('http://docs.engineblock.io/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="http://docs.engineblock.io/stylesheets/application.css">
    <link rel="stylesheet" href="http://docs.engineblock.io/stylesheets/temporary.css">
    <link rel="stylesheet" href="http://docs.engineblock.io/stylesheets/palettes.css">
    <link rel="stylesheet" href="http://docs.engineblock.io/stylesheets/images.css">

    <link rel="stylesheet" href="http://docs.engineblock.io/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto&#43;Mono">
    <style>
      body, input {
        font-family: 'Roboto', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="http://docs.engineblock.io/javascripts/modernizr.js"></script>

    

  
    
    

    
    
    <script src="http://docs.engineblock.io//modules/viz/viz.js"></script>
    

    
    

    
    

    
    

    
    

    
    
    
    
    

    
    


      
    
    <link href="http://docs.engineblock.io//modules/annotatorjs/annotator.css" rel="stylesheet" />
    <script src="http://docs.engineblock.io//modules/annotatorjs/jquery-3.2.1.js"></script>
    <script src="http://docs.engineblock.io//modules/annotatorjs/annotator.js"></script>
    <script>
        var app = new annotator.App();
        app.include(annotator.ui.main);
        app
            .start()
            .then(function() {
                app.annotations.load();
            });
    </script>


  </head>
  <body class="palette-primary-grey palette-accent-teal">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Tracking Concepts
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/engineblock/engineblock" title="@engineblock/engineblock on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="http://docs.engineblock.io/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://docs.engineblock.io/images/engineblock_128.png">
        </div>
      
      <div class="name">
        <strong>EngineBlock </strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="EngineBlock" href="http://docs.engineblock.io/">
	
	EngineBlock
</a>



  
</li>



<li>
  
    



<a  title="Quickstart" href="http://docs.engineblock.io/quickstart/">
	
	Quickstart
</a>



  
</li>



<li>
  
    <span class="section">User Guide</span>
    <ul>
      
        
        



<a  title="Concepts" href="http://docs.engineblock.io/user-guide/concepts/">
	
	Concepts
</a>



      
        
        



<a  title="Command Line" href="http://docs.engineblock.io/user-guide/command_line/">
	
	Command Line
</a>



      
        
        



<a  title="CLI Scripting" href="http://docs.engineblock.io/user-guide/cli_scripting/">
	
	CLI Scripting
</a>



      
        
        



<a  title="YAML Config" href="http://docs.engineblock.io/user-guide/standard_yaml/">
	
	YAML Config
</a>



      
        
        



<a  title="Using Metrics" href="http://docs.engineblock.io/user-guide/using_metrics/">
	
	Using Metrics
</a>



      
        
        



<a  title="Standard Metrics" href="http://docs.engineblock.io/user-guide/standard_metrics/">
	
	Standard Metrics
</a>



      
        
        



<a  title="Scenario Scripting" href="http://docs.engineblock.io/user-guide/scenario_scripting/">
	
	Scenario Scripting
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Parameters</span>
    <ul>
      
        
        



<a  title="Activity Params" href="http://docs.engineblock.io/parameters/activity_params/">
	
	Activity Params
</a>



      
        
        



<a  title="Example Command" href="http://docs.engineblock.io/parameters/example_command/">
	
	Example Command
</a>



      
        
        



<a  title="Parameter Usage" href="http://docs.engineblock.io/parameters/parameter_usage/">
	
	Parameter Usage
</a>



      
        
        



<a  title="Statement Params" href="http://docs.engineblock.io/parameters/statement_params/">
	
	Statement Params
</a>



      
    </ul>
  
</li>



<li>
  
    <span class="section">Dev Guide</span>
    <ul>
      
        
        



<a  title="Activity Internals" href="http://docs.engineblock.io/dev-guide/activity_internals/">
	
	Activity Internals
</a>



      
        
        



<a  title="Building ActivityTypes" href="http://docs.engineblock.io/dev-guide/building_activities/">
	
	Building ActivityTypes
</a>



      
        
        



<a  title="Contributing" href="http://docs.engineblock.io/dev-guide/contributing/">
	
	Contributing
</a>



      
        
        



<a  title="Diag ActivityType" href="http://docs.engineblock.io/dev-guide/annotated_diag/">
	
	Diag ActivityType
</a>



      
        
        



<a  title="Project Structure" href="http://docs.engineblock.io/dev-guide/project_structure/">
	
	Project Structure
</a>



      
        
        



<a  title="Scripting Extensions" href="http://docs.engineblock.io/dev-guide/scripting_extensions/">
	
	Scripting Extensions
</a>



      
        
        



<a  title="YAML Config API" href="http://docs.engineblock.io/dev-guide/standard_yam_devl/">
	
	YAML Config API
</a>



      
    </ul>
  
</li>


        </ul>
        

        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Tracking Concepts </h1>

			

<p>This section is meant to clarify some of the concepts used within engineblock
for marking results of one activity and tracking them for use by other
activities.</p>

<h1 id="activities-and-cycles">Activities and Cycles</h1>

<p>As before, all activities running within an engineblock scenario iterate
on cycles. Whereas before, each activity would operate exclusively on
a contiguous interval of cycles, now activities can operate on a set of
cycles which are not contiguous. Still, the cycles must be in order.</p>

<p>This means that the hand-off of cycle values from the core thread harness (aka
&lsquo;motor&rsquo;) to the individual action thread must now include individual cycle data
rather than simple interval bounds.</p>

<h1 id="cycle-results">Cycle Results</h1>

<h2 id="cycle-result-format">Cycle Result Format</h2>

<p>The result produced by a given cycle is called the <em>cycle result</em>. It can be any
value between 0 and 127, inclusive. Why the limit? There is a trade-off between
flexibility and efficiency. It is unlikely that you would want more than even a
dozen different outcomes to be handled within a specific test. If this type is
too narrow, it can be widened in a future release.</p>

<h2 id="cycle-result-semantics">Cycle Result Semantics</h2>

<p>Each activity type has its own way to interpret cycle results by default.
Further each activity instance may have a local mapping that determines what
different result values mean. For example, activity type A may assert that cycle
results with value 3 <em>always</em> mean &ldquo;timed out connecting to transport&rdquo;, while
activity type B may provide the ability to map the internal result details to a
scenario-specific result table.</p>

<p>In essence, Each activity type will be responsible for determining what a result
value means, and in some cases, the individual parameters of activity instances
may provide more filtering.</p>

<h1 id="result-marking">Result Marking</h1>

<p>Result marking is the act of recording the result value and the cycle that
produced it. Implementations that do this are termed <em>markers</em>. Different marker
implementations trade-off performance, data size, etc.</p>

<p>When an activity is configured with a marker, every cycle that is completed is
recorded before the next available cycle is dispatched to an action.</p>

<p>All result marker implementations are based around the internal cycle result
consumer API, known as <em>CycleResultSink</em>. When a result marker implementation
records a result, takes the common API form and stores it in an internal form.</p>

<h2 id="marking-contiguous-cycle-ranges">Marking contiguous cycle ranges</h2>

<p>Result markers are required to coalesce their results into contiguous chunks of
data. This serves multiple purposes, including micro-batching the marker updates
into discrete chunks of consumable state. As such, near-time processes such as
other activities may consume marker data as a near-time data stream.</p>

<p>The core marker logic works this way:</p>

<ol>
<li>Organize marker data (cycles and results) into linked buffering extents.</li>
<li>Accept updates within a window, assigning them to the correct extent.</li>
<li>Once the first extent is complete, publish it to any downstream consumers.</li>
</ol>

<p>If an update is presented for a cycle higher than that in the allowed buffering
extents, then the tracker must block the producer until the window is open for
that cycle number, and unblock when the appropriate extent is ready. Updates for
already-published extents are not allowed and cause an exception to be thrown.</p>

<h2 id="marking-non-contiguous-cycle-ranges">Marking non-contiguous cycle ranges</h2>

<p>Presently, marker implementations do not support marking non-contiguous cycle
ranges. This is expected to added in the future with a slight API change.</p>

<h2 id="result-data-and-marking-state">Result Data and Marking State</h2>

<p>Marking implementations may keep internal stream head or other data structure
management state as required to support the lifetime of the producing activity.
This is separate from the marking semantics of (cycle, result) and should not be
persisted with that data.</p>

<h1 id="result-tracking">Result Tracking</h1>

<p>Result tracking is the act of providing timely updates from marked result state to
a cycle result consumer.</p>

<p>Internally, all tracker implementations are based around the internal cycle
result producer API, known as <em>CycleResultSource</em>. When a result tracker implementation
provides a result, it reads an internal form and converts it to the common API form.</p>

<h2 id="result-tracking-state">Result tracking state</h2>

<p>Multiple concurrent trackers should be able to consume the
same marker data with no logical conflicts.</p>

<h1 id="marking-and-tracking-implementations">Marking and Tracking implementations</h1>

<p>Because both markers and trackers act as near-time SERDES for an internal form, they
are often found in pairs. Consider this example of an in-memory implementation:</p>



<div align="center" class="viz-text"><pre>
digraph ring {
 rankdir=LR;
 node[shape=box]
 edge[dir=out]
 state[label=&#34;ring buffer\nin memory&#34;,shape=&#34;ellipse&#34;];
 A[label=&#34;Activity\nA&#34;];
 B[label=&#34;Activity\nB&#34;];
 marker[label=&#34;mem\nmarker&#34;]
 tracker[label=&#34;mem\ntracker&#34;]

 A -&gt; marker;
 marker -&gt; state;
 state -&gt; tracker;
 tracker -&gt; B;
}
</pre></div>
<script type="text/javascript" src="http://docs.engineblock.io/modules/viz/inithook-viz.js"></script>


<h2 id="core-marker-tracker">Core Marker Tracker</h2>

<p>The following diagram provides a basic schematic of how the core marker tracker
works. An atomically managed linked list of extents is kept for both the marking
and tracking services. When the head of the marker extents chain is undefined,
then the marker caller must block and wait for tracking to catch up and prepare
the next extent. Likewise, when the head of the tracking extents chain is
undefined, then the tracker caller must block and wait for the marker callers to
catch up.</p>



<div align="center" class="viz-text"><pre>
digraph extents {
    rankdir=LR;
    node[shape=box]
    size=&#34;8&#34;;
    E3[shape=&#34;record&#34;,label=&#34;E3|{[13,20)}|{&lt;0&gt;0|&lt;1&gt;1|&lt;2&gt;2|&lt;3&gt;3|&lt;4&gt;4|&lt;5&gt;5|&lt;6&gt;6|&lt;7&gt;7}&#34;]
    E4[shape=&#34;record&#34;,label=&#34;E4|{[20,27)}|{&lt;0&gt;0|&lt;1&gt;1|&lt;2&gt;2|&lt;3&gt;3|&lt;4&gt;4|&lt;5&gt;5|&lt;6&gt;6|&lt;7&gt;7}&#34;]
    E5[shape=&#34;record&#34;,label=&#34;E5|{[27,34)}|{&lt;0&gt;0|&lt;1&gt;1|&lt;2&gt;2|&lt;3&gt;3|&lt;4&gt;4|&lt;5&gt;5|&lt;6&gt;6|&lt;7&gt;7}&#34;]
    undefined[label=&#34;undefined&#34;]

    E3 -&gt; E4 -&gt; E5 [label=&#34;next&#34;]
    marker -&gt; E4 [label=&#34;head marking\nextent&#34;]
    marker -&gt; undefined [style=&#34;dotted&#34;,fillcolor=&#34;none&#34;]

    tracker -&gt; E3 [label=&#34;head tracking\nextent&#34;]
    tracker -&gt; undefined [style=&#34;dotted&#34;,fillcolor=&#34;none&#34;]
}
</pre></div>
<script type="text/javascript" src="http://docs.engineblock.io/modules/viz/inithook-viz.js"></script>


<p>There are important invariants that must be maintained outside of critical sections
in order to avoid concurrent deadlocks.</p>

<ol>
<li>At all times, either a marker or a tracker must be defined. This is seeded by
the initializer logic, which prepares the max extents number of extents before
marking commences.</li>
<li>The tracker head extent will either be the oldest/lowest numbered extent or it will be null.</li>
<li>The marker head extent will be</li>
<li>Marking logic does not prepare new marking extents. Only trackers do that.</li>
<li>Tracking logic does not see partially completed extents.</li>
<li>By extension, the head of the marking and tracking chain can never be the same,
and if both are defined, the head marker extent must be ahead of the head tracker extent.</li>
</ol>

<h2 id="examples">Examples</h2>

<h3 id="initial-state">initial state</h3>



<div align="center" class="viz-text"><pre>
digraph extents {
    rankdir=LR;
    node[shape=box]
    size=&#34;4&#34;;

    E3 -&gt; E4 -&gt; E5

    marker -&gt; E3
    tracker -&gt; undefined
}
</pre></div>
<script type="text/javascript" src="http://docs.engineblock.io/modules/viz/inithook-viz.js"></script>


<h3 id="extent-filled">extent filled</h3>



<div align="center" class="viz-text"><pre>
digraph extents {
    rankdir=LR;
    node[shape=box]
    size=&#34;4&#34;;

    E3[style=&#34;bold&#34;]
    E3 -&gt; E4 -&gt; E5

    marker -&gt; E4
    tracker -&gt; E3
}
</pre></div>
<script type="text/javascript" src="http://docs.engineblock.io/modules/viz/inithook-viz.js"></script>


<h3 id="marker-outruns-tracker">marker outruns tracker</h3>



<div align="center" class="viz-text"><pre>
digraph extents {
    rankdir=LR;
    node[shape=box]
    size=&#34;4&#34;;

    E3[style=&#34;bold&#34;]
    E4[style=&#34;bold&#34;]
    E5[style=&#34;bold&#34;]
    E3 -&gt; E4 -&gt; E5

    marker -&gt; undefined
    tracker -&gt; E3
}
</pre></div>
<script type="text/javascript" src="http://docs.engineblock.io/modules/viz/inithook-viz.js"></script>


<h3 id="tracker-outruns-marker">tracker outruns marker</h3>



<div align="center" class="viz-text"><pre>
digraph extents {
    rankdir=LR;
    node[shape=box]
    size=&#34;4&#34;;

    E3 -&gt; E4 -&gt; E5

    marker -&gt; E3
    tracker -&gt; undefined
}
</pre></div>
<script type="text/javascript" src="http://docs.engineblock.io/modules/viz/inithook-viz.js"></script>



			<aside class="copyright" role="note">
				
				&copy; 2018 APL 2.0 &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="http://docs.engineblock.io/sketches/" title="Design Sketches">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Design Sketches
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="http://docs.engineblock.io/dev-guide/" title="EngineBlock Dev Guide">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              EngineBlock Dev Guide
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="http://docs.engineblock.io/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "¶";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

