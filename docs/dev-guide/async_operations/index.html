<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Async Operations - EngineBlock</title>
    <meta name="generator" content="Hugo 0.46" />

    
    <meta name="description" content="EngineBlock Docs">
    
    <link rel="canonical" href="http://docs.engineblock.io/dev-guide/async_operations/">
    

    <meta property="og:url" content="http://docs.engineblock.io/dev-guide/async_operations/">
    <meta property="og:title" content="EngineBlock">
    <meta property="og:image" content="/images/engineblock_128.png">
    <meta name="apple-mobile-web-app-title" content="EngineBlock">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../../images/engineblock_32.png">
    <link rel="icon" type="image/x-icon" href="../../images/engineblock_32.png">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('/fonts/icon.eot?52m981');
        src: url('/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('/fonts/icon.woff?52m981')
               format('woff'),
             url('/fonts/icon.ttf?52m981')
               format('truetype'),
             url('/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="../../stylesheets/application.css">
    <link rel="stylesheet" href="../../stylesheets/temporary.css">
    <link rel="stylesheet" href="../../stylesheets/palettes.css">
    <link rel="stylesheet" href="../../stylesheets/images.css">

    <link rel="stylesheet" href="../../stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto&#43;Mono">
    <style>
      body, input {
        font-family: 'Roboto', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="../../javascripts/modernizr.js"></script>

    

  

    
    

    
    

    
    

    
    
    <script src="http://docs.engineblock.io//modules/jssequence/webfont.js"></script>
    <script src="http://docs.engineblock.io//modules/jssequence/snap.svg-min.js"></script>
    <script src="http://docs.engineblock.io//modules/jssequence/underscore-min.js"></script>
    <script src="http://docs.engineblock.io//modules/jssequence/sequence-diagram.js"></script>
    <link href="http://docs.engineblock.io//modules/jssequence/sequence-diagram-min.css" rel="stylesheet" />
    

    
    
    <script src="http://docs.engineblock.io//modules/railroad/railroad-diagrams.js"></script>
    <link href="http://docs.engineblock.io//modules/railroad/railroad-diagrams.css" rel="stylesheet">
    

    
    
    <link href="http://docs.engineblock.io//modules/jsxgraph/jsxgraph.css" type="text/css" rel="stylesheet"/>
    <script src="http://docs.engineblock.io//modules/jsxgraph//jsxgraphcore.js"></script>
    
    

    
    
    <link href="http://docs.engineblock.io//modules/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script src="http://docs.engineblock.io//modules/mermaid/mermaid.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    

    
    
    <script src="http://docs.engineblock.io//modules/nomnoml/lodash.min.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/dagre.min.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/skanaar.util.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/skanaar.svg.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/skanaar.vector.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/skanaar.canvas.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/nomnoml.jison.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/nomnoml.parser.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/nomnoml.layouter.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/nomnoml.renderer.js"></script>
    <script src="http://docs.engineblock.io//modules/nomnoml/nomnoml.js"></script>
    

    
    

    
    


  </head>
  <body class="palette-primary-grey palette-accent-teal">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Async Operations
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/engineblock/engineblock" title="@engineblock/engineblock on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="http://docs.engineblock.io/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://docs.engineblock.io/images/engineblock_128.png">
        </div>
      
      <div class="name">
        <strong>EngineBlock </strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="EngineBlock" href="../../">
	
	EngineBlock
</a>





  
</li>



<li>
  
    



<a  title="Quickstart" href="../../quickstart/">
	
	Quickstart
</a>





  
</li>



<li>
  
    <span class="section">User Guide</span>
    <ul>
      
        
        



<a  title="Concepts" href="../../user-guide/concepts/">
	
	Concepts
</a>





      
        
        



<a  title="Command Line" href="../../user-guide/command_line/">
	
	Command Line
</a>





      
        
        



<a  title="CLI Scripting" href="../../user-guide/cli_scripting/">
	
	CLI Scripting
</a>





      
        
        



<a  title="YAML Config" href="../../user-guide/standard_yaml/">
	
	YAML Config
</a>





      
        
        



<a  title="Timing Terms" href="../../user-guide/timing_terms/">
	
	Timing Terms
</a>





      
        
        



<a  title="Using Metrics" href="../../user-guide/using_metrics/">
	
	Using Metrics
</a>





      
        
        



<a  title="Standard Metrics" href="../../user-guide/standard_metrics/">
	
	Standard Metrics
</a>





      
        
        



<a  title="Coordinated Omission" href="../../user-guide/coordinated_omission/">
	
	Coordinated Omission
</a>





      
        
        



<a  title="Scenario Scripting" href="../../user-guide/scenario_scripting/">
	
	Scenario Scripting
</a>





      
    </ul>
  
</li>



<li>
  
    <span class="section">Parameters</span>
    <ul>
      
        
        



<a  title="Parameter Usage" href="../../parameters/parameter_usage/">
	
	Parameter Usage
</a>





      
        
        



<a  title="Example Command" href="../../parameters/example_command/">
	
	Example Command
</a>





      
        
        



<a  title="Activity Params" href="../../parameters/activity_params/">
	
	Activity Params
</a>





      
        
        



<a  title="Statement Params" href="../../parameters/statement_params/">
	
	Statement Params
</a>





      
    </ul>
  
</li>



<li>
  
    <span class="section">Dev Guide</span>
    <ul>
      
        
        



<a  title="Activity Internals" href="../../dev-guide/activity_internals/">
	
	Activity Internals
</a>





      
        
        



<a  title="Async Operations" href="../../dev-guide/async_operations/">
	
	Async Operations
</a>





      
        
        



<a  title="Building ActivityTypes" href="../../dev-guide/building_activities/">
	
	Building ActivityTypes
</a>





      
        
        



<a  title="Contributing" href="../../dev-guide/contributing/">
	
	Contributing
</a>





      
        
        



<a  title="Design Guidelines" href="../../dev-guide/implementors_guide/">
	
	Design Guidelines
</a>





      
        
        



<a  title="Diag ActivityType" href="../../dev-guide/annotated_diag/">
	
	Diag ActivityType
</a>





      
        
        



<a  title="Project Structure" href="../../dev-guide/project_structure/">
	
	Project Structure
</a>





      
        
        



<a  title="Scripting Extensions" href="../../dev-guide/scripting_extensions/">
	
	Scripting Extensions
</a>





      
        
        



<a  title="Error Mapping" href="../../dev-guide/error_mapping/">
	
	Error Mapping
</a>





      
        
        



<a  title="YAML Config API" href="../../dev-guide/standard_yam_devl/">
	
	YAML Config API
</a>





      
    </ul>
  
</li>


        </ul>
        

        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Async Operations </h1>

			

<h2 id="introduction">Introduction</h2>

<p>In EngineBlock, two types of activities are supported: sync or async. Going forward, the async interface will be
refined and hardened, and then the sync interface will be deprecated. This is simply a matter of simplifying the
API over time, and the async interface is the essential one. If you want synchronous behavior with the async
interface, you can easily achieve that, but not the other way around.</p>

<h3 id="configuring-async">Configuring Async</h3>

<p>In an async activity, you still have multiple threads, but in this case, each thread is allowed to juggle one or
more asynchronous operations. The <code>async=100</code> parameter, for example, informs an activity that it needs to allocate
100 total operations over the allocated threads. In the case of <code>async=100 threads=10</code>, it is the responsibility
of the ActivityType&rsquo;s action dispenser to configure their actions to know that each of them can juggle 10 operations
each.</p>

<div class="admonition note">
<p class="admonition-title"></p>
<p><p>The <em>async</em> parameter has a standard meaning in engineblock. If it is defined, async is enabled. Its
parameter value is the number of total async operations that can be in flight at any one instant, with the number
per-thread divided as evenly as possible over all the threads.</p>

<p>If the async parameter is defined, but the action implementation does <em>not</em> implement the async logic,
then an error is thrown to the user. This is to ensure that users are aware of when they are expecting async
behavior but getting something else.</p>
</p>
</div>

<h3 id="async-messaging-flow">Async Messaging Flow</h3>

<p>The contract between a motor and an action is very basic.</p>

<ul>
<li>Each motor submits as many async operations as is allowed to its action, as long as there are
cycles remaining, until the action signals that it is at its limit.</li>
<li>As long as an action is able to retire an operation by giving a result back to its motor,
the motor keeps providing one more and retiring one more, as long as there are cycles remaining.</li>
<li>Once there are no more cycles remaining, the motor retires operations from the action until
the action signals that no more are pending.</li>
</ul>

<p>The basic result of this is that each thread ramps up to its async juggling rate, hovers at that
rate, with a completion rate dependent on the target system, and then ramps down as pending ops
are retired back down to zero.</p>

<h3 id="advanced-signaling">Advanced Signaling</h3>

<p>Because of differences in client-side APIs and behavior, and the need to do simple and reliable
flow management in EngineBlock, there are a few details about the API that are worth understanding
as a developer.</p>

<ul>
<li>There are multiple return or signaling points in the lifetime of an op context:

<ol>
<li>When an action becomes aware that an operation has completed, it is up to the action to
mark the op context with a call to <code>opcontext.stop(result)</code> at that time. This is important,
because operations do not complete in the same order that they are submitted, especially
when other async logic is present. A common way to do this is to register a callback on
a listener, for example.</li>
<li>The action must still return this op context back to the motor when it is asked. Thus, it
is a common pattern to keep a linked list of operations that are ready to retire and thus
allow the action to control orderly shutdown of the motor without any guesswork about the
completion state of pending operations.</li>
<li>The op context can be a sub-type, if you need to specialize the details that you keep for
an in-flight operation. In fact, async actions <em>must</em> implement a basic factory method,
but it can return a simple op context if no specialization is needed.</li>
<li>op contexts are recycled to avoid heap pressure for high data rates. This makes it relatively
low-cost to use the specialized op context to hold contextual data that may otherwise be
expensive to <em>malloc</em> and <em>free</em>.</li>
</ol></li>
</ul>

<h3 id="examples">Examples</h3>

<p>Developers can refer to the Diag activity type implementation for further examples.</p>


			<aside class="copyright" role="note">
				
				&copy; 2018 APL 2.0 &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="http://docs.engineblock.io/dev-guide/error_mapping/" title="Error Mapping">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Error Mapping
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="http://docs.engineblock.io/dev-guide/implementors_guide/" title="Design Guidelines">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Design Guidelines
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="../../javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "¶";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

